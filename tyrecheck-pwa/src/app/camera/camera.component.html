<div class="camera-root">
  <!-- Top Bar -->
  <div class="topbar">
    <button class="icon-btn" (click)="onBack()" aria-label="Back">
      ✕
    </button>

    <div class="live-pill" *ngIf="mode === 'camera'">LIVE</div>
    <div class="live-pill alt" *ngIf="mode === 'upload'">UPLOAD</div>
  </div>

  <!-- Viewfinder Area -->
  <div class="viewfinder">
    <!-- CAMERA MODE -->
    <ng-container *ngIf="mode === 'camera'">
      <video #videoEl class="video" autoplay muted playsinline></video>

      <app-scanner-overlay [active]="isReady"></app-scanner-overlay>

      <div class="hint">
        <p>Align tire tread within the frame</p>
      </div>

      <!-- if autoplay blocked or camera error -->
      <div class="camera-overlay" *ngIf="cameraError">
        <div class="camera-card">
          <div class="camera-title">Camera unavailable</div>
          <div class="camera-text">{{ cameraError }}</div>
          <div class="camera-actions">
            <button class="secondary" (click)="enableCamera()">Try again</button>
            <button class="primary" (click)="switchToUpload()">Use upload</button>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- UPLOAD MODE -->
    <ng-container *ngIf="mode === 'upload'">
      <div class="upload-sim">
        <div class="tire-ghost"></div>
        <app-scanner-overlay [active]="false"></app-scanner-overlay>

        <div class="hint">
          <p>Upload a tire tread photo</p>
        </div>
      </div>

      <div class="camera-overlay thin" *ngIf="cameraError">
        <div class="camera-card">
          <div class="camera-text">{{ cameraError }}</div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Bottom Controls -->
  <div class="controls">
    <!-- hidden input for upload -->
    <input
      #fileInput
      class="file-input"
      type="file"
      accept="image/*"
      (change)="onFileSelected($event)"
    />

    <div class="controls-row">
      <!-- Left side: only shows in upload mode -->
      <button class="small-btn" (click)="switchToCamera()" *ngIf="mode === 'upload'">
        Camera
      </button>

      <!-- CAPTURE / PICK -->
      <button
        class="capture-btn"
        [disabled]="isUploading"
        (click)="mode === 'camera' ? captureFromCamera() : triggerFilePicker()"
        aria-label="Capture"
      >
        <span class="capture-inner"></span>
      </button>

      <!-- Right side: upload always available -->
      <button class="small-btn" (click)="switchToUploadAndPick()">
        Upload
      </button>
    </div>

    <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
    <div class="loading" *ngIf="isUploading">Analyzing…</div>
  </div>
</div>
